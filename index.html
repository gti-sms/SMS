<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Telefonia - Secretaria Municipal de Saúde PMPF</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ====== VARS & RESET ====== */
        :root{
            --primary:#2c6aa0;--primary-dark:#1e4a73;--secondary:#4caf50;
            --danger:#e74c3c;--warning:#f39c12;--light:#f8f9fa;
            --dark:#343a40;--gray:#6c757d;--border:#dee2e6;
            --shadow:0 4px 12px rgba(0,0,0,.1);--transition:all .3s ease;
            --radius:12px;--radius-sm:8px;
        }
        *{box-sizing:border-box;margin:0;padding:0;font-family:'Segoe UI',Tahoma,Arial,sans-serif}
        html,body{width:100%;height:100%;background:#f5f7fa;color:var(--dark);line-height:1.6;overflow-x:hidden}
        
        /* Container & Layout */
        .container{max-width:1400px;margin:0 auto;padding:0 20px;width:100%}
        
        /* Header Improvements */
        header{
            background:linear-gradient(135deg,var(--primary),var(--primary-dark));
            color:#fff;padding:15px 0;box-shadow:var(--shadow);
            position:sticky;top:0;z-index:1000;backdrop-filter:blur(10px);
        }
        .header-content{display:flex;justify-content:space-between;align-items:center;width:100%}
        .logo{display:flex;align-items:center;gap:15px}
        .logo i{font-size:2.2rem;filter:drop-shadow(0 2px 4px rgba(0,0,0,.2))}
        .logo h1{font-size:1.8rem;font-weight:700;letter-spacing:-0.5px}
        .header-actions{display:flex;gap:12px;align-items:center}
        .theme-toggle,.admin-toggle{
            background:rgba(255,255,255,.25);border:0;color:#fff;
            width:44px;height:44px;border-radius:50%;cursor:pointer;
            display:flex;align-items:center;justify-content:center;
            transition:var(--transition);backdrop-filter:blur(10px);
        }
        .theme-toggle:hover,.admin-toggle:hover{
            background:rgba(255,255,255,.4);transform:scale(1.05);
        }
        
        /* Modal Improvements */
        .login-modal{
            display:none;position:fixed;inset:0;
            background:rgba(0,0,0,.6);z-index:2000;
            align-items:center;justify-content:center;backdrop-filter:blur(5px);
        }
        .login-modal.active{display:flex}
        .login-form{
            background:#fff;padding:35px;border-radius:var(--radius);
            box-shadow:0 20px 40px rgba(0,0,0,.3);width:100%;
            max-width:420px;transform:translateY(-20px);animation:slideUp .3s ease forwards;
        }
        @keyframes slideUp{to{transform:translateY(0)}}
        .login-form h2{margin-bottom:25px;color:var(--primary-dark);text-align:center;font-weight:600}
        
        /* Form Improvements */
        .form-group{margin-bottom:20px}
        .form-group label{display:block;margin-bottom:8px;font-weight:600;color:var(--dark)}
        .form-control{
            width:100%;padding:12px 16px;border:2px solid var(--border);
            border-radius:var(--radius-sm);font-size:1rem;transition:var(--transition);
            background:#fff;
        }
        .form-control:focus{
            outline:none;border-color:var(--primary);box-shadow:0 0 0 3px rgba(44,106,160,.15);
            transform:translateY(-1px);
        }
        .btn{
            padding:12px 24px;border:0;border-radius:var(--radius-sm);cursor:pointer;
            font-weight:600;transition:var(--transition);display:flex;
            align-items:center;gap:10px;font-size:0.95rem;
        }
        .btn-primary{background:var(--primary);color:#fff}
        .btn-primary:hover{background:var(--primary-dark);transform:translateY(-2px);box-shadow:0 4px 12px rgba(44,106,160,.3)}
        .btn-secondary{background:var(--gray);color:#fff}
        .btn-success{background:var(--secondary);color:#fff}
        .btn-success:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(76,175,80,.3)}
        .btn-danger{background:var(--danger);color:#fff}
        .btn-warning{background:var(--warning);color:#fff}
        
        /* Admin Panel Improvements */
        .admin-panel{
            display:none;background:#fff;border-radius:var(--radius);
            padding:30px;margin:30px 0;box-shadow:var(--shadow);width:100%;
            border:1px solid rgba(0,0,0,.05);
        }
        .admin-panel.active{display:block;animation:fadeIn .3s ease}
        @keyframes fadeIn{from{opacity:0} to{opacity:1}}
        .admin-header{
            display:flex;justify-content:space-between;align-items:center;
            margin-bottom:25px;padding-bottom:20px;
            border-bottom:3px solid var(--primary);
        }
        .admin-title{font-size:1.6rem;font-weight:700;color:var(--primary-dark)}
        .admin-tabs{
            display:flex;gap:5px;margin-bottom:25px;border-bottom:2px solid var(--border);
            background:#f8f9fa;padding:5px;border-radius:var(--radius-sm);
        }
        .admin-tab{
            padding:12px 24px;cursor:pointer;border-radius:var(--radius-sm);
            transition:var(--transition);font-weight:500;flex:1;text-align:center;
        }
        .admin-tab.active{background:var(--primary);color:#fff;box-shadow:var(--shadow)}
        .admin-content{display:none}
        .admin-content.active{display:block;animation:slideIn .3s ease}
        @keyframes slideIn{from{transform:translateX(10px);opacity:0} to{transform:translateX(0);opacity:1}}
        .form-grid{
            display:grid;grid-template-columns:repeat(auto-fit,minmax(320px,1fr));
            gap:25px;margin-bottom:25px;
        }
        .form-actions{display:flex;gap:12px;justify-content:flex-end;margin-top:30px}
        .units-list{display:flex;flex-direction:column;gap:15px;max-height:500px;overflow-y:auto;padding:5px}
        .unit-item{
            background:var(--light);border-radius:var(--radius-sm);padding:20px;
            border-left:5px solid var(--primary);display:flex;
            justify-content:space-between;align-items:center;transition:var(--transition);
        }
        .unit-item:hover{transform:translateX(5px);box-shadow:0 4px 12px rgba(0,0,0,.1)}
        .unit-actions{display:flex;gap:10px}
        
        /* Search & Cards Improvements */
        .search-container{
            background:#fff;border-radius:var(--radius);padding:30px;
            margin:30px 0;box-shadow:var(--shadow);width:100%;
            border:1px solid rgba(0,0,0,.05);
        }
        .search-box{display:flex;gap:12px;margin-bottom:25px;width:100%}
        .search-input{
            flex:1;padding:16px 20px;border:2px solid var(--border);
            border-radius:var(--radius-sm);font-size:1rem;transition:var(--transition);
            background:#fff;
        }
        .search-input:focus{
            border-color:var(--primary);box-shadow:0 0 0 3px rgba(44,106,160,.15);
            transform:translateY(-1px);
        }
        .search-btn{
            background:var(--primary);color:#fff;border:0;
            border-radius:var(--radius-sm);padding:0 30px;cursor:pointer;
            transition:var(--transition);font-weight:600;font-size:1rem;
        }
        .search-btn:hover{background:var(--primary-dark);transform:translateY(-2px);box-shadow:0 4px 12px rgba(44,106,160,.3)}
        .filter-options{display:flex;gap:12px;flex-wrap:wrap;width:100%}
        .filter-btn{
            background:#fff;border:2px solid var(--border);border-radius:25px;
            padding:10px 20px;cursor:pointer;display:flex;align-items:center;
            gap:8px;transition:var(--transition);font-weight:500;font-size:0.9rem;
        }
        .filter-btn.active{
            background:var(--primary);color:#fff;border-color:var(--primary);
            transform:translateY(-2px);box-shadow:0 4px 12px rgba(44,106,160,.2);
        }
        .filter-btn:hover:not(.active){border-color:var(--primary);transform:translateY(-1px)}
        .service-filters{display:flex;gap:12px;flex-wrap:wrap;margin-top:20px;width:100%}
        
        /* Service Toggle Buttons */
        .service-toggle-btn{
            background:#fff;border:2px solid var(--border);border-radius:25px;
            padding:12px 20px;cursor:pointer;display:flex;align-items:center;
            gap:10px;transition:var(--transition);font-size:0.9rem;color:var(--gray);
            font-weight:500;
        }
        .service-toggle-btn.active{
            background:var(--primary);color:#fff;border-color:var(--primary);
            transform:translateY(-2px);box-shadow:0 4px 12px rgba(44,106,160,.2);
        }
        .service-toggle-btn:hover:not(.active){border-color:var(--primary);transform:translateY(-1px)}
        .service-toggle-btn i{font-size:1rem}
        
        /* Tabs & Content */
        .tabs{
            display:flex;border-bottom:2px solid var(--border);margin-bottom:25px;
            flex-wrap:wrap;background:#f8f9fa;padding:5px;border-radius:var(--radius-sm);
        }
        .tab{
            padding:14px 28px;cursor:pointer;border-radius:var(--radius-sm);
            transition:var(--transition);font-weight:600;flex:1;text-align:center;
        }
        .tab.active{background:var(--primary);color:#fff;box-shadow:var(--shadow)}
        .content{display:none;width:100%}
        .content.active{display:block;animation:fadeIn .4s ease}
        .results-count{
            margin-bottom:20px;color:var(--gray);font-size:.95rem;width:100%;
            padding:12px 0;font-weight:500;
        }
        
        /* Contact Cards Improvements */
        .contact-grid{
            display:grid;grid-template-columns:repeat(auto-fill,minmax(380px,1fr));
            gap:25px;width:100%;
        }
        .contact-card{
            background:#fff;border-radius:var(--radius);padding:25px;
            box-shadow:var(--shadow);transition:var(--transition);
            border-left:5px solid var(--primary);display:flex;flex-direction:column;
            min-height:420px;position:relative;border:1px solid rgba(0,0,0,.05);
        }
        .contact-card:hover{
            transform:translateY(-5px);box-shadow:0 12px 24px rgba(0,0,0,.15);
        }
        .favorite-btn{
            position:absolute;top:20px;right:20px;background:none;border:0;
            font-size:1.4rem;color:var(--gray);cursor:pointer;z-index:10;
            transition:var(--transition);
        }
        .favorite-btn:hover{transform:scale(1.2)}
        .favorite-btn.active{color:var(--warning)}
        .contact-header{
            display:flex;justify-content:space-between;align-items:flex-start;
            margin-bottom:20px;width:100%;
        }
        .contact-name{font-size:1.3rem;font-weight:700;color:var(--primary-dark);line-height:1.3}
        .contact-type{
            background:rgba(44,106,160,.1);color:var(--primary);padding:6px 14px;
            border-radius:20px;font-size:.85rem;font-weight:600;
        }
        .contact-info{
            display:flex;flex-direction:column;gap:14px;width:100%;flex-grow:1;
        }
        .contact-item{
            display:flex;align-items:flex-start;gap:12px;width:100%;
            padding:8px 0;
        }
        .contact-item i{width:20px;color:var(--primary);margin-top:2px;font-size:1.1rem}
        .contact-services{
            display:flex;justify-content:space-between;margin-top:20px;
            padding-top:20px;border-top:2px solid var(--border);width:100%;
        }
        .service{
            display:flex;flex-direction:column;align-items:center;text-align:center;
            transition:var(--transition);
        }
        .service i{font-size:1.4rem;margin-bottom:.4rem;transition:var(--transition)}
        .service.available{color:var(--secondary)}
        .service.available i{transform:scale(1.1)}
        .service.unavailable{color:var(--gray);opacity:.6}
        .service-label{font-size:.75rem;margin-top:.3rem;font-weight:600}
        .contact-actions{
            display:flex;gap:12px;margin-top:20px;width:100%;
        }
        .action-btn{
            flex:1;padding:12px;border:0;border-radius:var(--radius-sm);
            cursor:pointer;font-weight:600;display:flex;align-items:center;
            justify-content:center;gap:8px;transition:var(--transition);
            font-size:0.9rem;
        }
        .action-btn:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,.2)}
        .call-btn{background:var(--secondary);color:#fff}
        .whatsapp-btn{background:#25D366;color:#fff}
        .location-btn{background:transparent;border:2px solid var(--border);color:var(--gray)}
        .location-btn:hover{background:var(--border);color:var(--dark)}
        
        .no-results{
            text-align:center;padding:50px;color:var(--gray);width:100%;
            background:#fff;border-radius:var(--radius);box-shadow:var(--shadow);
        }
        .no-results i{font-size:3rem;margin-bottom:20px;color:var(--primary);opacity:.5}
        
        /* Footer */
        .footer{
            background:var(--dark);color:#fff;text-align:center;padding:25px 0;
            position:fixed;bottom:0;left:0;width:100%;z-index:100;
            backdrop-filter:blur(10px);background:rgba(52,58,64,.95);
        }
        
        /* Dark Mode */
        body.dark-mode{
            background:#1a1d23;color:#e9ecef;
        }
        body.dark-mode .search-container,
        body.dark-mode .contact-card,
        body.dark-mode .filter-btn,
        body.dark-mode .service-toggle-btn,
        body.dark-mode .admin-panel,
        body.dark-mode .unit-item,
        body.dark-mode .login-form{
            background:#2d3239;color:#e9ecef;border-color:#3d434b;
        }
        body.dark-mode .search-input,
        body.dark-mode .filter-btn,
        body.dark-mode .service-toggle-btn,
        body.dark-mode .form-control{
            background:#343a40;border-color:#495057;color:#e9ecef;
        }
        body.dark-mode .search-input:focus,
        body.dark-mode .form-control:focus{
            border-color:var(--primary);box-shadow:0 0 0 3px rgba(44,106,160,.3);
        }
        body.dark-mode .service-toggle-btn{
            background:#343a40;border-color:#495057;color:#e9ecef;
        }
        body.dark-mode .service-toggle-btn.active{
            background:var(--primary);color:#fff;border-color:var(--primary);
        }
        body.dark-mode .service-toggle-btn:hover:not(.active){
            border-color:var(--primary);
        }
        
        /* CLASSES PARA LÓGICA CONDICIONAL */
        .hidden {
            display: none !important;
        }
        
        /* GitHub Sync Status */
        .sync-status {
            padding: 15px;
            border-radius: var(--radius-sm);
            margin: 10px 0;
            text-align: center;
        }
        .sync-success {
            background: rgba(76, 175, 80, 0.1);
            border: 1px solid var(--secondary);
            color: var(--secondary);
        }
        .sync-error {
            background: rgba(231, 76, 60, 0.1);
            border: 1px solid var(--danger);
            color: var(--danger);
        }
        .sync-loading {
            background: rgba(44, 106, 160, 0.1);
            border: 1px solid var(--primary);
            color: var(--primary);
        }
        
        /* Enhanced Responsive Design */
        @media (max-width:1200px){
            .contact-grid{grid-template-columns:repeat(auto-fill,minmax(350px,1fr))}
            .form-grid{grid-template-columns:repeat(auto-fit,minmax(280px,1fr))}
        }
        
        @media (max-width:992px){
            .contact-grid{grid-template-columns:repeat(auto-fill,minmax(320px,1fr))}
            .admin-tabs,.tabs{flex-wrap:wrap}
            .admin-tab,.tab{flex:1 1 calc(50% - 10px);min-width:140px}
        }
        
        @media (max-width:768px){
            .header-content{flex-direction:column;gap:15px;text-align:center}
            .contact-grid,.ramais-container{grid-template-columns:1fr}
            .search-box{flex-direction:column}
            .filter-options,.service-filters{justify-content:center}
            .tabs{overflow-x:auto;white-space:nowrap;flex-wrap:nowrap}
            .form-grid{grid-template-columns:1fr}
            .unit-item{flex-direction:column;align-items:flex-start;gap:15px}
            .unit-actions{width:100%;justify-content:flex-end}
            .admin-tabs,.tabs{padding:3px}
            .admin-tab,.tab{padding:10px 16px;font-size:0.9rem}
            .contact-card{min-height:380px;padding:20px}
            .contact-actions{flex-direction:column}
            .action-btn{width:100%}
            .form-actions{flex-direction:column}
            .btn{width:100%;justify-content:center}
        }
        
        @media (max-width:480px){
            .logo h1{font-size:1.5rem}
            .logo i{font-size:1.8rem}
            .tab{padding:10px 12px;font-size:.85rem}
            .service-toggle-btn{padding:10px 15px;font-size:0.8rem;gap:6px}
            .filter-btn{padding:8px 15px;font-size:0.8rem}
            .search-input{padding:14px 16px}
            .contact-grid{gap:15px}
            .container{padding:0 15px}
            .search-container,.admin-panel{padding:20px}
            .contact-card{padding:18px;min-height:360px}
            .contact-name{font-size:1.2rem}
            .contact-item{gap:10px;padding:6px 0}
            .contact-services{margin-top:15px;padding-top:15px}
        }
        
        @media (max-width:360px){
            .contact-grid{grid-template-columns:1fr}
            .admin-tab,.tab{flex:1 1 100%;min-width:100%}
            .filter-options,.service-filters{gap:8px}
            .filter-btn,.service-toggle-btn{padding:8px 12px;font-size:0.75rem}
        }
        
        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Smooth Scrolling */
        html {
            scroll-behavior: smooth;
        }
        
        /* Selection Color */
        ::selection {
            background: rgba(44,106,160,.2);
            color: var(--primary-dark);
        }
    </style>
</head>
<body>
    <!-- LOGIN MODAL -->
    <div class="login-modal" id="loginModal" aria-hidden="true">
        <div class="login-form" role="dialog" aria-labelledby="loginTitle">
            <h2 id="loginTitle"><i class="fas fa-lock"></i> Acesso Administrativo</h2>
            <form id="loginForm">
                <div class="form-group">
                    <label for="loginUsername">Usuário:</label>
                    <input type="text" id="loginUsername" class="form-control" required autocomplete="username">
                </div>
                <div class="form-group">
                    <label for="loginPassword">Senha:</label>
                    <input type="password" id="loginPassword" class="form-control" required autocomplete="current-password">
                </div>
                <div class="form-actions" style="justify-content:center;">
                    <button type="submit" class="btn btn-primary"><i class="fas fa-sign-in-alt"></i> Entrar</button>
                </div>
            </form>
        </div>
    </div>

    <div id="telefonia-container">
        <header>
            <div class="container">
                <div class="header-content">
                    <div class="logo">
                        <i class="fas fa-phone-alt"></i>
                        <div>
                            <h1>Telefonia - SMS</h1>
                        </div>
                    </div>
                    <div class="header-actions">
                        <button class="admin-toggle" id="adminToggle" title="Painel Administrativo"><i class="fas fa-cogs"></i></button>
                        <button class="theme-toggle" id="themeToggle" title="Alternar tema"><i class="fas fa-moon"></i></button>
                    </div>
                </div>
            </div>
        </header>

        <!-- ADMIN PANEL -->
        <div class="admin-panel" id="adminPanel" aria-hidden="true">
            <div class="container">
                <div class="admin-header">
                    <h2 class="admin-title">Painel Administrativo</h2>
                    <div>
                        <button class="btn btn-secondary" id="closeAdmin"><i class="fas fa-times"></i> Fechar</button>
                        <button class="btn btn-danger" id="logoutBtn" style="display:none;"><i class="fas fa-sign-out-alt"></i> Sair</button>
                    </div>
                </div>

                <div class="admin-tabs" role="tablist">
                    <div class="admin-tab active" data-tab="units" role="tab">Gerenciar Unidades</div>
                    <div class="admin-tab" data-tab="add" role="tab">Adicionar Unidade</div>
                    <div class="admin-tab" data-tab="github" role="tab">GitHub Sync</div>
                    <div class="admin-tab" data-tab="config" role="tab">Configurações</div>
                </div>

                <!-- UNITS -->
                <div class="admin-content active" id="units-content">
                    <h3>Unidades Cadastradas</h3>
                    <div class="units-list" id="unitsList"></div>
                </div>

                <!-- ADD / EDIT UNIT -->
                <div class="admin-content" id="add-content">
                    <h3 id="formTitle">Adicionar Nova Unidade</h3>
                    <form id="unitForm">
                        <div class="form-grid">
                            <div class="form-group"><label for="unitName">Nome da Unidade *</label><input type="text" id="unitName" class="form-control" required></div>
                            <div class="form-group"><label for="unitType">Tipo *</label>
                                <select id="unitType" class="form-control" required>
                                    <option value="">Selecione o tipo</option>
                                    <option value="promocao">Promoção</option>
                                    <option value="recuperacao">Recuperação</option>
                                    <option value="administrativo">Administrativo</option>
                                    <option value="vigilancia">Vigilância</option>
                                    <option value="capne">Capne</option>
                                    <option value="outros">Outros</option>
                                </select>
                            </div>
                            <div class="form-group"><label for="unitAddress">Endereço *</label><input type="text" id="unitAddress" class="form-control" required placeholder="Ex: Rua Exemplo, 123"><small class="form-text">O link do Google Maps será gerado automaticamente</small></div>
                            <div class="form-group"><label for="unitBairro">Bairro *</label><input type="text" id="unitBairro" class="form-control" required placeholder="Ex: Centro"></div>
                            <div class="form-group"><label for="unitPhone">Telefone *</label><input type="text" id="unitPhone" class="form-control" required placeholder="Ex: 3314-1234"><small class="form-text">O link do WhatsApp será gerado automaticamente</small></div>
                            <div class="form-group"><label for="unitEmail">E-mail</label><input type="email" id="unitEmail" class="form-control" placeholder="exemplo@pmpf.rs.gov.br"></div>
                            
                            <!-- Campo Responsável (será exibido condicionalmente) -->
                            <div class="form-group hidden" id="responsibleFieldContainer">
                                <label for="unitResponsavel">Responsável *</label>
                                <input type="text" id="unitResponsavel" class="form-control" placeholder="Nome do responsável pela unidade">
                            </div>
                            
                            <div class="form-group" id="enfermeiroField"><label for="unitEnfermeiro">Enfermeiro Responsável</label><input type="text" id="unitEnfermeiro" class="form-control" placeholder="Nome do enfermeiro responsável"></div>
                            <div class="form-group" id="gerenteField"><label for="unitGerente">Gerente Responsável</label><input type="text" id="unitGerente" class="form-control" placeholder="Nome do gerente responsável"></div>
                            <div class="form-group" id="vacinaField"><label for="unitVacina">Sala de Vacina</label><select id="unitVacina" class="form-control"><option value="Não">Não</option><option value="Sim">Sim</option></select></div>
                            <div class="form-group" id="odontoField"><label for="unitOdonto">Consultório Odontológico</label><select id="unitOdonto" class="form-control"><option value="Não">Não</option><option value="Sim">Sim</option></select></div>
                            <div class="form-group" id="farmaciaField"><label for="unitFarmacia">Farmácia</label><select id="unitFarmacia" class="form-control"><option value="Não">Não</option><option value="Sim">Sim</option></select></div>
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn btn-secondary" id="cancelEdit" style="display:none;"><i class="fas fa-times"></i> Cancelar</button>
                            <button type="reset" class="btn btn-secondary"><i class="fas fa-eraser"></i> Limpar</button>
                            <button type="submit" class="btn btn-success" id="submitBtn"><i class="fas fa-plus"></i> Adicionar Unidade</button>
                        </div>
                    </form>
                </div>

                <!-- GITHUB SYNC -->
                <div class="admin-content" id="github-content">
                    <h3><i class="fab fa-github"></i> Sincronização com GitHub</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="githubToken">Token do GitHub *</label>
                            <input type="password" id="githubToken" class="form-control" 
                                   placeholder="ghp_xxxxxxxxxxxxxxxxxxxx">
                            <small class="form-text">
                                <a href="https://github.com/settings/tokens" target="_blank">Gerar token</a> 
                                (precisa das permissões: repo)
                            </small>
                        </div>
                        <div class="form-group">
                            <label for="repoOwner">Proprietário do Repositório</label>
                            <input type="text" id="repoOwner" class="form-control" 
                                   placeholder="seu-usuario" value="gti-sms">
                        </div>
                        <div class="form-group">
                            <label for="repoName">Nome do Repositório</label>
                            <input type="text" id="repoName" class="form-control" 
                                   placeholder="telefonia-sms" value="SMS">
                        </div>
                        <div class="form-group">
                            <label for="filePath">Caminho do Arquivo</label>
                            <input type="text" id="filePath" class="form-control" 
                                   placeholder="data/units.json" value="data/units.json">
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-primary" id="saveGitHubConfig">
                            <i class="fas fa-save"></i> Salvar Configuração
                        </button>
                        <button type="button" class="btn btn-success" id="syncToGitHub">
                            <i class="fas fa-cloud-upload-alt"></i> Sincronizar para GitHub
                        </button>
                        <button type="button" class="btn btn-warning" id="pullFromGitHub">
                            <i class="fas fa-cloud-download-alt"></i> Puxar do GitHub
                        </button>
                        <button type="button" class="btn btn-info" id="testConnection">
                            <i class="fas fa-plug"></i> Testar Conexão
                        </button>
                    </div>
                    <div id="syncStatus" style="margin-top: 20px;"></div>
                    
                    <!-- Instruções de configuração -->
                    <div style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: var(--radius-sm);">
                        <h4><i class="fas fa-info-circle"></i> Instruções de Configuração:</h4>
                        <ol style="margin-left: 20px; margin-top: 10px;">
                            <li>Vá para <a href="https://github.com/settings/tokens" target="_blank">GitHub Settings > Tokens</a></li>
                            <li>Clique em "Generate new token"</li>
                            <li>Dê um nome descritivo (ex: "Telefonia SMS")</li>
                            <li>Selecione a permissão <strong>"repo"</strong></li>
                            <li>Clique em "Generate token"</li>
                            <li>Cole o token no campo acima e clique em "Salvar Configuração"</li>
                        </ol>
                    </div>
                </div>

                <!-- CONFIG -->
                <div class="admin-content" id="config-content">
                    <h3>Configurações do Sistema</h3>
                    <div class="form-grid">
                        <div class="form-group"><label for="backupData">Backup de Dados</label><button type="button" id="backupData" class="btn btn-primary"><i class="fas fa-download"></i> Fazer Backup</button></div>
                        <div class="form-group"><label for="restoreData">Restaurar Dados</label><input type="file" id="restoreData" class="form-control" accept=".json"></div>
                        <div class="form-group"><label for="clearAll">Limpar Todos os Dados</label><button type="button" id="clearAll" class="btn btn-danger"><i class="fas fa-trash"></i> Limpar Tudo</button></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- MAIN -->
        <main class="container" style="padding-bottom:120px;">
            <div class="search-container">
                <div class="search-box">
                    <input type="text" class="search-input" id="searchInput" placeholder="Buscar por nome, telefone, endereço, enfermeiro ou gerente...">
                    <button class="search-btn" id="searchBtn"><i class="fas fa-search"></i> Buscar</button>
                </div>

                <div class="filter-options">
                    <button class="filter-btn active" data-filter="all"><i class="fas fa-th-large"></i> Todos</button>
                    <button class="filter-btn" data-filter="promocao"><i class="fas fa-heart"></i> Promoção</button>
                    <button class="filter-btn" data-filter="recuperacao"><i class="fas fa-stethoscope"></i> Recuperação</button>
                    <button class="filter-btn" data-filter="administrativo"><i class="fas fa-building"></i> Administrativo</button>
                    <button class="filter-btn" data-filter="vigilancia"><i class="fas fa-shield-virus"></i> Vigilância</button>
                    <button class="filter-btn" data-filter="capne"><i class="fas fa-baby"></i> Capne</button>
                    <button class="filter-btn" data-filter="outros"><i class="fas fa-ellipsis-h"></i> Outros</button>
                </div>

                <div class="service-filters">
                    <button class="service-toggle-btn active" data-service="all"><i class="fas fa-asterisk"></i> Todos os Serviços</button>
                    <button class="service-toggle-btn" data-service="vacina"><i class="fas fa-syringe"></i> Sala de Vacina</button>
                    <button class="service-toggle-btn" data-service="odonto"><i class="fas fa-tooth"></i> Odontológico</button>
                    <button class="service-toggle-btn" data-service="farmacia"><i class="fas fa-pills"></i> Farmácia</button>
                </div>
            </div>

            <div class="tabs" role="tablist">
                <div class="tab active" data-tab="unidades" role="tab"><i class="fas fa-clinic-medical"></i> Unidades de Saúde</div>
                <div class="tab" data-tab="ramais" role="tab"><i class="fas fa-phone"></i> Ramais</div>
            </div>

            <div class="results-count" id="resultsCount">Carregando unidades...</div>

            <div class="content active" id="unidades-content">
                <div class="contact-grid" id="contactGrid"></div>
            </div>

            <div class="content" id="ramais-content">
                <div class="contact-grid" id="ramaisContainer"></div>
            </div>
        </main>

        <footer class="footer">
            <div class="container">
                <p>Secretaria Municipal de Saúde - Prefeitura Municipal de Passo Fundo/RS</p>
            </div>
        </footer>
    </div>

    <script>
        // ========== VARIÁVEIS GLOBAIS ==========
        let units = [];
        let isAdmin = false;
        let editingUnitId = null;
        let currentFilter = 'all';
        let currentServiceFilter = 'all';
        let currentTab = 'unidades';
        let isDarkMode = false;
        let gitHubConfig = {
            token: '',
            repoOwner: 'gti-sms',
            repoName: 'SMS',
            filePath: 'data/units.json'
        };

        // ========== INICIALIZAÇÃO ==========
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            loadGitHubConfig();
            loadUnits();
            setupEventListeners();
            applyTheme();
        }

        // ========== GITHUB INTEGRATION ==========
        async function loadUnits() {
            showLoading('contactGrid', 'Carregando unidades...');
            
            // Tenta carregar do GitHub primeiro
            try {
                const data = await fetchFromGitHub();
                if (data && data.units) {
                    units = data.units;
                    showSyncStatus('Dados carregados do GitHub com sucesso!', 'success');
                    renderUnits();
                    return;
                }
            } catch (error) {
                console.log('Não foi possível carregar do GitHub:', error);
            }
            
            // Fallback para dados locais
            const localData = localStorage.getItem('telefoniaUnits');
            if (localData) {
                try {
                    const parsed = JSON.parse(localData);
                    units = parsed.units || parsed;
                    showSyncStatus('Dados carregados do armazenamento local', 'warning');
                } catch (e) {
                    units = [];
                    showSyncStatus('Erro ao carregar dados locais', 'error');
                }
            } else {
                units = getDefaultUnits();
                showSyncStatus('Usando dados padrão do sistema', 'info');
            }
            
            renderUnits();
        }

        async function fetchFromGitHub() {
            if (!gitHubConfig.token) {
                throw new Error('Token do GitHub não configurado');
            }

            const url = `https://api.github.com/repos/${gitHubConfig.repoOwner}/${gitHubConfig.repoName}/contents/${gitHubConfig.filePath}`;
            
            const response = await fetch(url, {
                headers: {
                    'Authorization': `token ${gitHubConfig.token}`,
                    'Accept': 'application/vnd.github.v3+json'
                }
            });

            if (!response.ok) {
                throw new Error(`GitHub API error: ${response.status}`);
            }

            const data = await response.json();
            const content = atob(data.content);
            return JSON.parse(content);
        }

        async function saveToGitHub() {
            if (!gitHubConfig.token) {
                showSyncStatus('Erro: Token do GitHub não configurado', 'error');
                return false;
            }

            showSyncStatus('Enviando dados para GitHub...', 'loading');

            try {
                // Primeiro, obtém o SHA do arquivo atual (se existir)
                let sha = null;
                try {
                    const currentFile = await fetchFromGitHub();
                    sha = currentFile.sha;
                } catch (e) {
                    // Arquivo não existe, vamos criar um novo
                }

                const data = {
                    units: units,
                    lastUpdated: new Date().toISOString(),
                    totalUnits: units.length
                };

                const content = btoa(JSON.stringify(data, null, 2));
                
                const url = `https://api.github.com/repos/${gitHubConfig.repoOwner}/${gitHubConfig.repoName}/contents/${gitHubConfig.filePath}`;
                
                const response = await fetch(url, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${gitHubConfig.token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: `Atualização automática: ${new Date().toLocaleString()}`,
                        content: content,
                        sha: sha
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || 'Erro ao salvar no GitHub');
                }

                showSyncStatus('Dados salvos no GitHub com sucesso!', 'success');
                return true;
            } catch (error) {
                console.error('Erro ao salvar no GitHub:', error);
                showSyncStatus(`Erro: ${error.message}`, 'error');
                return false;
            }
        }

        function loadGitHubConfig() {
            const saved = localStorage.getItem('gitHubConfig');
            if (saved) {
                gitHubConfig = { ...gitHubConfig, ...JSON.parse(saved) };
                document.getElementById('githubToken').value = gitHubConfig.token || '';
                document.getElementById('repoOwner').value = gitHubConfig.repoOwner;
                document.getElementById('repoName').value = gitHubConfig.repoName;
                document.getElementById('filePath').value = gitHubConfig.filePath;
            }
        }

        function saveGitHubConfig() {
            gitHubConfig.token = document.getElementById('githubToken').value;
            gitHubConfig.repoOwner = document.getElementById('repoOwner').value;
            gitHubConfig.repoName = document.getElementById('repoName').value;
            gitHubConfig.filePath = document.getElementById('filePath').value;
            
            localStorage.setItem('gitHubConfig', JSON.stringify(gitHubConfig));
            showSyncStatus('Configuração do GitHub salva com sucesso!', 'success');
        }

        function showSyncStatus(message, type) {
            const statusEl = document.getElementById('syncStatus');
            if (!statusEl) return;
            
            statusEl.innerHTML = `
                <div class="sync-status sync-${type}">
                    <i class="fas fa-${getStatusIcon(type)}"></i>
                    ${type === 'loading' ? '<span class="loading" style="margin-right: 10px;"></span>' : ''}
                    ${message}
                </div>
            `;
        }

        function getStatusIcon(type) {
            const icons = {
                success: 'check-circle',
                error: 'exclamation-circle',
                warning: 'exclamation-triangle',
                info: 'info-circle',
                loading: 'sync'
            };
            return icons[type] || 'info-circle';
        }

        // ========== EVENT LISTENERS ==========
        function setupEventListeners() {
            // Login
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.getElementById('logoutBtn').addEventListener('click', handleLogout);
            
            // Admin Panel
            document.getElementById('adminToggle').addEventListener('click', toggleAdminPanel);
            document.getElementById('closeAdmin').addEventListener('click', closeAdminPanel);
            
            // Admin Tabs
            document.querySelectorAll('.admin-tab').forEach(tab => {
                tab.addEventListener('click', () => switchAdminTab(tab.dataset.tab));
            });
            
            // GitHub
            document.getElementById('saveGitHubConfig').addEventListener('click', saveGitHubConfig);
            document.getElementById('syncToGitHub').addEventListener('click', saveToGitHub);
            document.getElementById('pullFromGitHub').addEventListener('click', loadUnits);
            document.getElementById('testConnection').addEventListener('click', testGitHubConnection);
            
            // Unit Form
            document.getElementById('unitForm').addEventListener('submit', handleUnitSubmit);
            document.getElementById('unitType').addEventListener('change', handleUnitTypeChange);
            document.getElementById('cancelEdit').addEventListener('click', cancelEdit);
            
            // Search and Filters
            document.getElementById('searchBtn').addEventListener('click', performSearch);
            document.getElementById('searchInput').addEventListener('input', performSearch);
            document.getElementById('searchInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') performSearch();
            });
            
            // Filter Buttons
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentFilter = btn.dataset.filter;
                    renderUnits();
                });
            });
            
            // Service Filters
            document.querySelectorAll('.service-toggle-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.service-toggle-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentServiceFilter = btn.dataset.service;
                    renderUnits();
                });
            });
            
            // Main Tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
                    tab.classList.add('active');
                    currentTab = tab.dataset.tab;
                    document.getElementById(`${tab.dataset.tab}-content`).classList.add('active');
                    renderUnits();
                });
            });
            
            // Theme Toggle
            document.getElementById('themeToggle').addEventListener('click', toggleTheme);
            
            // Backup/Restore
            document.getElementById('backupData').addEventListener('click', backupData);
            document.getElementById('restoreData').addEventListener('change', restoreData);
            document.getElementById('clearAll').addEventListener('click', clearAllData);
        }

        // ========== GITHUB CONNECTION TEST ==========
        async function testGitHubConnection() {
            if (!gitHubConfig.token) {
                showSyncStatus('Erro: Token do GitHub não configurado', 'error');
                return;
            }

            showSyncStatus('Testando conexão com GitHub...', 'loading');

            try {
                const url = `https://api.github.com/repos/${gitHubConfig.repoOwner}/${gitHubConfig.repoName}`;
                const response = await fetch(url, {
                    headers: {
                        'Authorization': `token ${gitHubConfig.token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });

                if (response.ok) {
                    showSyncStatus('Conexão com GitHub estabelecida com sucesso!', 'success');
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                showSyncStatus(`Erro na conexão: ${error.message}`, 'error');
            }
        }

        // ========== RENDER FUNCTIONS ==========
        function renderUnits() {
            if (currentTab === 'ramais') {
                renderRamais();
            } else {
                renderUnidades();
            }
        }

        function renderUnidades() {
            const grid = document.getElementById('contactGrid');
            if (!grid) return;

            let filteredUnits = filterUnits(units);
            
            if (filteredUnits.length === 0) {
                grid.innerHTML = `
                    <div class="no-results">
                        <i class="fas fa-search"></i>
                        <h3>Nenhuma unidade encontrada</h3>
                        <p>Tente ajustar os filtros ou termos de busca</p>
                    </div>
                `;
                updateResultsCount(0);
                return;
            }

            grid.innerHTML = filteredUnits.map(unit => `
                <div class="contact-card" data-id="${unit.id}">
                    <button class="favorite-btn ${unit.favorite ? 'active' : ''}" onclick="toggleFavorite('${unit.id}')">
                        <i class="fas fa-star"></i>
                    </button>
                    
                    <div class="contact-header">
                        <h3 class="contact-name">${unit.name}</h3>
                        <span class="contact-type">${getTypeLabel(unit.type)}</span>
                    </div>
                    
                    <div class="contact-info">
                        <div class="contact-item">
                            <i class="fas fa-map-marker-alt"></i>
                            <div>
                                <strong>Endereço:</strong><br>
                                ${unit.address} - ${unit.bairro}
                            </div>
                        </div>
                        
                        <div class="contact-item">
                            <i class="fas fa-phone"></i>
                            <div>
                                <strong>Telefone:</strong><br>
                                ${unit.phone}
                            </div>
                        </div>
                        
                        ${unit.email ? `
                        <div class="contact-item">
                            <i class="fas fa-envelope"></i>
                            <div>
                                <strong>E-mail:</strong><br>
                                ${unit.email}
                            </div>
                        </div>` : ''}
                        
                        ${unit.enfermeiro ? `
                        <div class="contact-item">
                            <i class="fas fa-user-nurse"></i>
                            <div>
                                <strong>Enfermeiro:</strong><br>
                                ${unit.enfermeiro}
                            </div>
                        </div>` : ''}
                        
                        ${unit.gerente ? `
                        <div class="contact-item">
                            <i class="fas fa-user-tie"></i>
                            <div>
                                <strong>Gerente:</strong><br>
                                ${unit.gerente}
                            </div>
                        </div>` : ''}
                    </div>
                    
                    <div class="contact-services">
                        <div class="service ${unit.vacina === 'Sim' ? 'available' : 'unavailable'}">
                            <i class="fas fa-syringe"></i>
                            <div class="service-label">Vacina</div>
                        </div>
                        <div class="service ${unit.odonto === 'Sim' ? 'available' : 'unavailable'}">
                            <i class="fas fa-tooth"></i>
                            <div class="service-label">Odonto</div>
                        </div>
                        <div class="service ${unit.farmacia === 'Sim' ? 'available' : 'unavailable'}">
                            <i class="fas fa-pills"></i>
                            <div class="service-label">Farmácia</div>
                        </div>
                    </div>
                    
                    <div class="contact-actions">
                        <button class="action-btn call-btn" onclick="callNumber('${unit.phone}')">
                            <i class="fas fa-phone"></i> Ligar
                        </button>
                        <button class="action-btn whatsapp-btn" onclick="openWhatsApp('${unit.phone}')">
                            <i class="fab fa-whatsapp"></i> WhatsApp
                        </button>
                        <button class="action-btn location-btn" onclick="openLocation('${unit.address}, ${unit.bairro}')">
                            <i class="fas fa-map"></i> Mapa
                        </button>
                    </div>
                </div>
            `).join('');

            updateResultsCount(filteredUnits.length);
        }

        function renderRamais() {
            const container = document.getElementById('ramaisContainer');
            if (!container) return;

            // Filtra apenas unidades administrativas para ramais
            const ramais = units.filter(unit => unit.type === 'administrativo');
            
            if (ramais.length === 0) {
                container.innerHTML = `
                    <div class="no-results">
                        <i class="fas fa-phone"></i>
                        <h3>Nenhum ramal encontrado</h3>
                        <p>Não há unidades administrativas cadastradas</p>
                    </div>
                `;
                updateResultsCount(0);
                return;
            }

            container.innerHTML = ramais.map(unit => `
                <div class="contact-card" data-id="${unit.id}">
                    <div class="contact-header">
                        <h3 class="contact-name">${unit.name}</h3>
                        <span class="contact-type">Ramal</span>
                    </div>
                    
                    <div class="contact-info">
                        <div class="contact-item">
                            <i class="fas fa-phone"></i>
                            <div>
                                <strong>Ramal:</strong><br>
                                ${unit.phone}
                            </div>
                        </div>
                        
                        ${unit.email ? `
                        <div class="contact-item">
                            <i class="fas fa-envelope"></i>
                            <div>
                                <strong>E-mail:</strong><br>
                                ${unit.email}
                            </div>
                        </div>` : ''}
                        
                        ${unit.responsavel ? `
                        <div class="contact-item">
                            <i class="fas fa-user"></i>
                            <div>
                                <strong>Responsável:</strong><br>
                                ${unit.responsavel}
                            </div>
                        </div>` : ''}
                    </div>
                    
                    <div class="contact-actions">
                        <button class="action-btn call-btn" onclick="callNumber('${unit.phone}')">
                            <i class="fas fa-phone"></i> Ligar
                        </button>
                        ${unit.email ? `
                        <button class="action-btn whatsapp-btn" onclick="sendEmail('${unit.email}')">
                            <i class="fas fa-envelope"></i> E-mail
                        </button>` : ''}
                    </div>
                </div>
            `).join('');

            updateResultsCount(ramais.length);
        }

        // ========== HELPER FUNCTIONS ==========
        function filterUnits(unitsList) {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            
            return unitsList.filter(unit => {
                // Filtro de tipo
                if (currentFilter !== 'all' && unit.type !== currentFilter) {
                    return false;
                }
                
                // Filtro de serviços
                if (currentServiceFilter !== 'all') {
                    if (currentServiceFilter === 'vacina' && unit.vacina !== 'Sim') return false;
                    if (currentServiceFilter === 'odonto' && unit.odonto !== 'Sim') return false;
                    if (currentServiceFilter === 'farmacia' && unit.farmacia !== 'Sim') return false;
                }
                
                // Filtro de busca
                if (searchTerm) {
                    const searchFields = [
                        unit.name, unit.phone, unit.address, unit.bairro, 
                        unit.enfermeiro, unit.gerente, unit.responsavel
                    ].filter(Boolean);
                    
                    return searchFields.some(field => 
                        field.toLowerCase().includes(searchTerm)
                    );
                }
                
                return true;
            });
        }

        function updateResultsCount(count) {
            const element = document.getElementById('resultsCount');
            if (element) {
                element.textContent = `${count} unidade${count !== 1 ? 's' : ''} encontrada${count !== 1 ? 's' : ''}`;
            }
        }

        function showLoading(containerId, message = 'Carregando...') {
            const container = document.getElementById(containerId);
            if (container) {
                container.innerHTML = `
                    <div class="no-results">
                        <i class="fas fa-spinner fa-spin"></i>
                        <h3>${message}</h3>
                    </div>
                `;
            }
        }

        function getTypeLabel(type) {
            const labels = {
                'promocao': 'Promoção',
                'recuperacao': 'Recuperação',
                'administrativo': 'Administrativo',
                'vigilancia': 'Vigilância',
                'capne': 'Capne',
                'outros': 'Outros'
            };
            return labels[type] || type;
        }

        // ========== ACTION FUNCTIONS ==========
        function callNumber(phone) {
            window.open(`tel:${phone}`, '_self');
        }

        function openWhatsApp(phone) {
            const cleanedPhone = phone.replace(/\D/g, '');
            window.open(`https://wa.me/55${cleanedPhone}`, '_blank');
        }

        function openLocation(address) {
            window.open(`https://maps.google.com/?q=${encodeURIComponent(address)}`, '_blank');
        }

        function sendEmail(email) {
            window.open(`mailto:${email}`, '_blank');
        }

        function toggleFavorite(id) {
            const unit = units.find(u => u.id === id);
            if (unit) {
                unit.favorite = !unit.favorite;
                saveUnits();
                renderUnits();
            }
        }

        // ========== ADMIN FUNCTIONS ==========
        function handleLogin(e) {
            e.preventDefault();
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            
            // Credenciais padrão (em produção, isso deve ser mais seguro)
            if (username === 'admin' && password === 'sms2024') {
                isAdmin = true;
                document.getElementById('loginModal').classList.remove('active');
                document.getElementById('logoutBtn').style.display = 'block';
                showSyncStatus('Login administrativo realizado com sucesso', 'success');
            } else {
                alert('Credenciais inválidas!');
            }
        }

        function handleLogout() {
            isAdmin = false;
            document.getElementById('logoutBtn').style.display = 'none';
            closeAdminPanel();
            showSyncStatus('Logout realizado', 'info');
        }

        function toggleAdminPanel() {
            if (!isAdmin) {
                document.getElementById('loginModal').classList.add('active');
                return;
            }
            
            const panel = document.getElementById('adminPanel');
            panel.classList.toggle('active');
            if (panel.classList.contains('active')) {
                renderUnitsList();
            }
        }

        function closeAdminPanel() {
            document.getElementById('adminPanel').classList.remove('active');
            cancelEdit();
        }

        function switchAdminTab(tabName) {
            document.querySelectorAll('.admin-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.admin-content').forEach(content => content.classList.remove('active'));
            
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            document.getElementById(`${tabName}-content`).classList.add('active');
        }

        function handleUnitTypeChange() {
            const type = document.getElementById('unitType').value;
            const responsibleField = document.getElementById('responsibleFieldContainer');
            
            // Mostra campo de responsável apenas para tipos administrativos
            if (type === 'administrativo') {
                responsibleField.classList.remove('hidden');
            } else {
                responsibleField.classList.add('hidden');
            }
        }

        function handleUnitSubmit(e) {
            e.preventDefault();
            
            const unitData = {
                name: document.getElementById('unitName').value,
                type: document.getElementById('unitType').value,
                address: document.getElementById('unitAddress').value,
                bairro: document.getElementById('unitBairro').value,
                phone: document.getElementById('unitPhone').value,
                email: document.getElementById('unitEmail').value,
                enfermeiro: document.getElementById('unitEnfermeiro').value,
                gerente: document.getElementById('unitGerente').value,
                vacina: document.getElementById('unitVacina').value,
                odonto: document.getElementById('unitOdonto').value,
                farmacia: document.getElementById('unitFarmacia').value,
                responsavel: document.getElementById('unitResponsavel').value || ''
            };
            
            if (editingUnitId) {
                // Editar unidade existente
                const index = units.findIndex(u => u.id === editingUnitId);
                if (index !== -1) {
                    units[index] = { ...units[index], ...unitData };
                }
            } else {
                // Adicionar nova unidade
                unitData.id = generateId();
                unitData.favorite = false;
                units.push(unitData);
            }
            
            saveUnits();
            renderUnits();
            renderUnitsList();
            document.getElementById('unitForm').reset();
            cancelEdit();
            
            showSyncStatus(`Unidade ${editingUnitId ? 'atualizada' : 'adicionada'} com sucesso!`, 'success');
        }

        function editUnit(id) {
            const unit = units.find(u => u.id === id);
            if (!unit) return;
            
            editingUnitId = id;
            document.getElementById('formTitle').textContent = 'Editar Unidade';
            document.getElementById('submitBtn').innerHTML = '<i class="fas fa-save"></i> Atualizar Unidade';
            document.getElementById('cancelEdit').style.display = 'block';
            
            // Preenche o formulário
            document.getElementById('unitName').value = unit.name;
            document.getElementById('unitType').value = unit.type;
            document.getElementById('unitAddress').value = unit.address;
            document.getElementById('unitBairro').value = unit.bairro;
            document.getElementById('unitPhone').value = unit.phone;
            document.getElementById('unitEmail').value = unit.email || '';
            document.getElementById('unitEnfermeiro').value = unit.enfermeiro || '';
            document.getElementById('unitGerente').value = unit.gerente || '';
            document.getElementById('unitVacina').value = unit.vacina || 'Não';
            document.getElementById('unitOdonto').value = unit.odonto || 'Não';
            document.getElementById('unitFarmacia').value = unit.farmacia || 'Não';
            document.getElementById('unitResponsavel').value = unit.responsavel || '';
            
            // Atualiza campos condicionais
            handleUnitTypeChange();
            
            // Muda para a aba de adição/edição
            switchAdminTab('add');
        }

        function deleteUnit(id) {
            if (!confirm('Tem certeza que deseja excluir esta unidade?')) return;
            
            units = units.filter(u => u.id !== id);
            saveUnits();
            renderUnits();
            renderUnitsList();
            
            showSyncStatus('Unidade excluída com sucesso!', 'success');
        }

        function cancelEdit() {
            editingUnitId = null;
            document.getElementById('formTitle').textContent = 'Adicionar Nova Unidade';
            document.getElementById('submitBtn').innerHTML = '<i class="fas fa-plus"></i> Adicionar Unidade';
            document.getElementById('cancelEdit').style.display = 'none';
            document.getElementById('unitForm').reset();
        }

        function renderUnitsList() {
            const list = document.getElementById('unitsList');
            if (!list) return;
            
            list.innerHTML = units.map(unit => `
                <div class="unit-item">
                    <div>
                        <h4>${unit.name}</h4>
                        <p><strong>Tipo:</strong> ${getTypeLabel(unit.type)} | <strong>Telefone:</strong> ${unit.phone}</p>
                        <p><strong>Endereço:</strong> ${unit.address} - ${unit.bairro}</p>
                    </div>
                    <div class="unit-actions">
                        <button class="btn btn-primary" onclick="editUnit('${unit.id}')">
                            <i class="fas fa-edit"></i> Editar
                        </button>
                        <button class="btn btn-danger" onclick="deleteUnit('${unit.id}')">
                            <i class="fas fa-trash"></i> Excluir
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // ========== THEME FUNCTIONS ==========
        function toggleTheme() {
            isDarkMode = !isDarkMode;
            applyTheme();
            localStorage.setItem('darkMode', isDarkMode);
        }

        function applyTheme() {
            const themeIcon = document.querySelector('#themeToggle i');
            if (isDarkMode) {
                document.body.classList.add('dark-mode');
                themeIcon.className = 'fas fa-sun';
            } else {
                document.body.classList.remove('dark-mode');
                themeIcon.className = 'fas fa-moon';
            }
        }

        // ========== BACKUP/RESTORE FUNCTIONS ==========
        function backupData() {
            const data = {
                units: units,
                exportedAt: new Date().toISOString(),
                version: '1.0'
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `telefonia-backup-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showSyncStatus('Backup realizado com sucesso!', 'success');
        }

        function restoreData(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    if (data.units && Array.isArray(data.units)) {
                        units = data.units;
                        saveUnits();
                        renderUnits();
                        renderUnitsList();
                        showSyncStatus('Dados restaurados com sucesso!', 'success');
                    } else {
                        throw new Error('Formato de arquivo inválido');
                    }
                } catch (error) {
                    alert('Erro ao restaurar dados: ' + error.message);
                }
            };
            reader.readAsText(file);
            e.target.value = ''; // Reset input
        }

        function clearAllData() {
            if (!confirm('ATENÇÃO: Isso irá apagar TODOS os dados. Tem certeza?')) return;
            if (!confirm('CONFIRMAÇÃO FINAL: Esta ação não pode ser desfeita. Continuar?')) return;
            
            units = getDefaultUnits();
            saveUnits();
            renderUnits();
            renderUnitsList();
            
            showSyncStatus('Todos os dados foram resetados', 'warning');
        }

        // ========== UTILITY FUNCTIONS ==========
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        function performSearch() {
            renderUnits();
        }

        function saveUnits() {
            const data = {
                units: units,
                lastUpdated: new Date().toISOString(),
                totalUnits: units.length
            };
            localStorage.setItem('telefoniaUnits', JSON.stringify(data));
        }

        // ========== DEFAULT DATA ==========
        function getDefaultUnits() {
            return [
                {
                    id: '1',
                    name: 'UBS Central',
                    type: 'promocao',
                    address: 'Rua General Neto, 123',
                    bairro: 'Centro',
                    phone: '3314-1000',
                    email: 'ubs.central@pmpf.rs.gov.br',
                    enfermeiro: 'Maria Silva',
                    gerente: 'João Santos',
                    vacina: 'Sim',
                    odonto: 'Sim',
                    farmacia: 'Sim',
                    responsavel: '',
                    favorite: false
                },
                {
                    id: '2',
                    name: 'CAPS II',
                    type: 'recuperacao',
                    address: 'Av. Brasil, 456',
                    bairro: 'São José',
                    phone: '3314-2000',
                    email: 'caps.ii@pmpf.rs.gov.br',
                    enfermeiro: 'Ana Oliveira',
                    gerente: 'Pedro Costa',
                    vacina: 'Não',
                    odonto: 'Sim',
                    farmacia: 'Sim',
                    responsavel: '',
                    favorite: false
                },
                {
                    id: '3',
                    name: 'Secretaria de Saúde',
                    type: 'administrativo',
                    address: 'Praça Marechal Floriano, 101',
                    bairro: 'Centro',
                    phone: '3314-3000',
                    email: 'secretaria.saude@pmpf.rs.gov.br',
                    enfermeiro: '',
                    gerente: '',
                    vacina: 'Não',
                    odonto: 'Não',
                    farmacia: 'Não',
                    responsavel: 'Carlos Mendes',
                    favorite: false
                }
            ];
        }

        // Carrega tema salvo
        const savedTheme = localStorage.getItem('darkMode');
        if (savedTheme !== null) {
            isDarkMode = JSON.parse(savedTheme);
        }
    </script>
</body>
</html>
